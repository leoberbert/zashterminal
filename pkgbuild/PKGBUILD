#Maintainer: Leonardo Berbert <leo4berbert@gmail.com>

pkgname=zashterminal
pkgdesc="A modern GTK4/Adwaita terminal emulator with advanced session management, SSH integration, and security features."

depends=(
    'gtk4'
    'libadwaita'
    'libsecret'
    'python'
    'python-cairo'
    'python-py7zr'
    'python-gobject'
    'python-setproctitle'
    'python-requests'
    'python-psutil'
    'sshpass'
    'rsync'
    'vte4'
    'gobject-introspection'
    'hicolor-icon-theme'
    'desktop-file-utils'
    'python-regex' # Optional, improved syntax highlighting performance'
    'python-pygments' # Optional, enhanced syntax highlighting in AI chat'
)
makedepends=(
    'python-build'
    'python-installer'
    'python-uv-build'
    'python-wheel'
)

conflicts=('zash')
provides=('zashterminal' 'zash')
replaces=('zash')

pkgver=${PKGVER:-$(date +%y.%m.%d)}
pkgrel=${PKGREL:-$(date +%H%M)}

arch=('any')
license=('GPL3')
url="https://github.com/leoberbert/${pkgname}"
source=("git+${url}.git")
md5sums=('SKIP')

build() {
    cd "${srcdir}/${pkgname}"
    python -m build --wheel --no-isolation --skip-dependency-check
}

package() {
    cd "${srcdir}/${pkgname}"

    python -m installer --destdir="$pkgdir" dist/*.whl

    # Install files
    cp -a usr/share "${pkgdir}/usr/share"
    install -Dm644 usr/share/icons/hicolor/scalable/apps/zashterminal.svg "${pkgdir}/usr/share/pixmaps/zashterminal.svg"

    # Install license file if present
    if [ -f "LICENSE" ]; then
        install -Dm644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
    fi

    # Install documentation if present
    if [ -f "README.md" ]; then
        install -Dm644 README.md "${pkgdir}/usr/share/doc/${pkgname}/README.md"
    fi
}

post_install() {
    update-desktop-database -q 2>/dev/null || true
    gtk-update-icon-cache -q -t -f /usr/share/icons/hicolor 2>/dev/null || true
}

post_upgrade() {
    post_install
}
